




<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Since version 2.x Angular favors Observables over Promises when it comes to async.  In this article we explore some practical advantages for server communication.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="thoughtram">
    <title>Taking advantage of Observables in Angular by thoughtram</title>
    <meta name="google-site-verification" content="o9eGPEgIETEqYGombq7NiQuBIB_qa6gz1yAL7PxKyK0">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4D8799">
    <link rel="icon" sizes="192x192" href="/images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="thoughtram">
    <link rel="apple-touch-icon" href="/images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#4D8799">

    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Taking advantage of Observables in Angular">
    <meta property="og:description" content="Since version 2.x Angular favors Observables over Promises when it comes to async.  In this article we explore some practical advantages for server communication.">
    <meta property="og:url" content="http://blog.thoughtram.io/angular/2016/01/06/taking-advantage-of-observables-in-angular2.html">
    <meta property="og:site_name" content="Articles by thoughtram">
    <meta property="og:image" content="http://blog.thoughtram.io/images/banner/taking-advantage-of-observables.png">
    <meta property="og:publisher" content="http://www.facebook.com/thoughtram">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="Taking advantage of Observables in Angular">
    <meta property="twitter:site" content="thoughtram Blog">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css" type="text/css">
  </head>
  <body class="sub-site">
    <!-- Add your site or app content here -->

    <!--[if lt IE 10]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <header class="thtrm-header" role="banner">
      <div class="thtrm-header-bar">
        <div class="thtrm-constraint">
          <a href="http://thoughtram.io" class="thtrm-header-logo-link" title="thoughtram.io Start Page"><h1 class="thtrm-header-logo">thoughtram</h1></a>
          <div class="thtrm-header-menu-wrapper">
            <span role="button" tabindex="0" class="thtrm-header-menu-label">Menu</span>
            <ul class="thtrm-header-menu">
              <li><a title="Training" class="thtrm-header-menu-item" href="http://thoughtram.io/training.html">Training</a></li>
              <li><a title="Code Review" class="thtrm-header-menu-item" href="http://thoughtram.io/code-review.html">Code Review</a></li>
              <li><a title="Casts" class="thtrm-header-menu-item " href="http://casts.thoughtram.io">Casts</a></li>
              <li><a title="Blog" class="thtrm-header-menu-item" href="/">Blog</a></li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <main role="main" class="thtrm-main">
    <div class="thtrm-banner" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%), url('/images/banner/taking-advantage-of-observables.png');">
        <hgroup class="thtrm-banner-container">
          <div class="thtrm-constraint thtrm-constraint--slim">
            <h2 class="thtrm-banner-text">Taking advantage of Observables in Angular</h2>
            <span>by <a href="http://twitter.com/" title="Christoph Burgdorf on Twitter">Christoph Burgdorf</a> on Jan 6, 2016, last updated on Nov 8, 2016<br>12 minute read</span>

          </div>
        </hgroup>
      </div>
      <div class="thtrm-constraint thtrm-constraint--slim">

        <div class="thtrm-article">
          <section class="thtrm-ad thtrm-section thtrm-section--is-promo is-sticky">
  <img width="100" src="/images/angular2-shield-inverse.svg">
  <h3 class="thtrm-section-headline">Need private training?</h3>
  <p class="thtrm-section-text">Get customized training for your corporation</p>
  <a href="mailto:hello@thoughtram.io" title="Request Training Quote" id="event-cta" class="thtrm-layout-divider-cta">Request quote <strong>&rarr;</strong></a>
</section>


          
          <p style="background-color: lightgoldenrodyellow; border: solid 2px #f9dead; padding: 1em; text-align: center; border-radius: 0.3em;">Contents are based on Angular version <strong>>= 2.x</strong> unless explicitely stated differently.</p>
          

          <p>Some people seem to be confused why Angular seems to favor the Observable abstraction over the Promise abstraction when it comes to dealing with async behavior.</p>

<p>There are pretty good resources about the difference between Observables and Promises already out there. I especially like to highlight this free <a href="https://egghead.io/lessons/rxjs-rxjs-observables-vs-promises">7 minutes video</a> by <a href="https://twitter.com/benlesh">Ben Lesh</a> on egghead.io. Technically there are a couple of obvious differences like the <em>disposability</em> and <em>lazyness</em> of Observables. In this article we like to focus on some practical advantages that Observables introduce for server communication.</p>

<p style="text-align: center; margin-bottom: -1em;"><strong>Want to see things in action first?</strong></p>

<p class="thtrm-ctas">

  
    <a href="#demos" class="thtrm-cta thtrm-cta--small"><i class="material-icons">code</i> View Demos</a>
  

  
    <a href="#videos" class="thtrm-cta thtrm-cta--small"><i class="material-icons">play_arrow</i> Play videos</a>
  

</p>

<div class="thtrm-toc is-sticky">
  <h3 class="no_toc" id="table-of-contents">TABLE OF CONTENTS</h3>
<ul id="markdown-toc">
  <li><a href="#the-scenario" id="markdown-toc-the-scenario">The scenario</a></li>
  <li><a href="#challenge-accepted" id="markdown-toc-challenge-accepted">Challenge accepted</a></li>
  <li><a href="#putting-some-sugar-on-top" id="markdown-toc-putting-some-sugar-on-top">Putting some sugar on top</a></li>
</ul>

</div>

<h2 id="the-scenario">The scenario</h2>

<p>Consider you are building a search input mask that should instantly show you results as you type.</p>

<p>If you’ve ever build such a thing before you are probably aware of the challenges that come with that task.</p>

<p><strong>1. Don’t hit the search endpoint on every key stroke</strong></p>

<p>Treat the search endpoint as if you pay for it on a per-request basis. No matter if it’s your own hardware or not. We shouldn’t be hammering
the search endpoint more often than needed. Basically we only want to hit it once the user has <em>stopped typing</em> instead of with every keystroke.</p>

<p><strong>2. Don’t hit the search endpoint with the same query params for subsequent requests</strong></p>

<p>Consider you type <em>foo</em>, stop, type another <em>o</em>, followed by an immediate backspace and rest back at <em>foo</em>. That should be just one request with the term <em>foo</em> and not two even if we technically stopped twice after we had <em>foo</em>  in the search box.</p>

<p><strong>3. Deal with out-of-order responses</strong></p>

<p>When we have multiple requests in-flight at the same time we must account for cases where they come back in unexpected order. Consider we first typed
<em>computer</em>, stop, a request goes out, we type <em>car</em>, stop, a request goes out. Now we have two requests in-flight. Unfortunately the request that carries the results for <em>computer</em> comes back
after the request that carries the results for <em>car</em>. This may happen because they are served by different servers. If we don’t deal with such cases properly we may end up showing results for <em>computer</em> whereas the search box reads <em>car</em>.</p>

<h2 id="challenge-accepted">Challenge accepted</h2>

<p>We will use the free and open wikipedia API to write a little demo.</p>

<p>For simplicity our demo will simply consist of two files: <code>app.ts</code> and <code>wikipedia-service.ts</code>. In a real world scenario we would most likely split things further up though.</p>

<p>Let’s start with a Promise-based implementation that doesn’t handle any of the described edge cases.</p>

<p>This is what our <code>WikipediaService</code> looks like. Despite the fact that the Http/JsonP API still has some little unergonomic parts, there shouldn’t be much of surprise here.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">URLSearchParams</span><span class="p">,</span> <span class="nx">Jsonp</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/http'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">WikipediaService</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">jsonp</span><span class="p">:</span> <span class="nx">Jsonp</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">search</span> <span class="p">(</span><span class="nx">term</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">()</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'action'</span><span class="p">,</span> <span class="s1">'opensearch'</span><span class="p">);</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'search'</span><span class="p">,</span> <span class="nx">term</span><span class="p">);</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'format'</span><span class="p">,</span> <span class="s1">'json'</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">jsonp</span>
                <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'http://en.wikipedia.org/w/api.php?callback=JSONP_CALLBACK'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">search</span> <span class="p">})</span>
                <span class="p">.</span><span class="nx">toPromise</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Basically we are injecting the <code>Jsonp</code> service to make a <code>GET</code> request against the wikipedia API with a given search term. Notice that we call <code>toPromise</code> in order to get from an <code>Observable&lt;Response&gt;</code> to a <code>Promise&lt;Response&gt;</code>. With a little bit of <code>then</code>-chaining we eventually end up with a <code>Promise&lt;Array&lt;string&gt;&gt;</code> as the return type of our <code>search</code> method.</p>

<p>So far so good, let’s take a look at the <code>app.ts</code> file that holds our <code>App</code> Component.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// check the plnkr for the full list of imports</span>
<span class="kr">import</span> <span class="p">{...}</span> <span class="nx">from</span> <span class="s1">'...'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'my-app'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;div&gt;
      &lt;h2&gt;Wikipedia Search&lt;/h2&gt;
      &lt;input #term type="text" (keyup)="search(term.value)"&gt;
      &lt;ul&gt;
        &lt;li *ngFor="let item of items"&gt;{{item}}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  `</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">wikipediaService</span><span class="p">:</span> <span class="nx">WikipediaService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">wikipediaService</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">)</span>
                         <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">items</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Not much of a surprise here either. We inject our <code>WikipediaService</code> and expose it’s functionality via a <code>search</code> method to the template. The template simply binds to <code>keyup</code> and calls <code>search(term.value)</code> leveraging Angular’s awesome <em>template ref</em> feature.</p>

<p>We unwrap the result of the <code>Promise</code> that the <code>search</code> method of the <code>WikipediaService</code> returns and expose it as a simple Array of strings to the template so that we can have <code>*ngFor</code> loop through it and build up a list for us.</p>

<p>You can play with the demo and fiddle with the code through this plnkr.</p>

<iframe src="http://embed.plnkr.co/Vp5ZmAAT68FqeKlBCp0Y/?deferRun" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<p>Unfortunately this implementation doesn’t address any of the described edge cases that we would like to deal with. Let’s refactor our code to make it match the expected behavior.</p>

<p><strong>Taming the user input</strong></p>

<p>Let’s change our code to not hammer the endpoint with every keystroke but instead only send a request when the user stopped typing for 400 ms. This is where Observables really shine. The Reactive Extensions (Rx) offer a broad range of operators that let us alter the behavior of Observables and create new Observables with the desired semantics.</p>

<p>To unveil such super powers we first need to get an <code>Observable&lt;string&gt;</code> that carries the search term that the user types in. Instead of manually binding to the <code>keyup</code> event, we can take advantage of Angular’s <code>formControl</code> directive. To use this directive, we first need to import the <code>ReactiveFormsModule</code> into our application module.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/platform-browser'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">JsonpModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/http'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ReactiveFormsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">BrowserModule</span><span class="p">,</span> <span class="nx">JsonpModule</span><span class="p">,</span> <span class="nx">ReactiveFormsModule</span><span class="p">]</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
  <span class="na">bootstrap</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span></code></pre></div>

<p>Once imported, we can use <code>formControl</code> from within our template and set it to the name <code>"term"</code>.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="p">[</span><span class="nx">formControl</span><span class="p">]</span><span class="o">=</span><span class="s2">"term"</span><span class="o">/&gt;</span></code></pre></div>

<p>In our component we create an instance of <code>FormControl</code> from <code>@angular/form</code> and expose it as a field under the name <code>term</code> on our component.</p>

<p>Behind the scenes <code>term</code> automatically exposes an <code>Observable&lt;string&gt;</code> as property <code>valueChanges</code> that we can subscribe to. Now that we have an <code>Observable&lt;string&gt;</code>, taming the user input is as easy as calling <code>debounceTime(400)</code> on our Observable. This will return a new <code>Observable&lt;string&gt;</code> that will only emit a new value when there haven’t been coming new values for 400ms.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">App</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nx">term</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormControl</span><span class="p">();</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">wikipediaService</span><span class="p">:</span> <span class="nx">WikipediaService</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">valueChanges</span>
             <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
             <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">term</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">wikipediaService</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">items</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><strong>Don’t hit me twice</strong></p>

<p>As we said, it would be a waste of resources to send out another request for a search term that our app already shows the results for. Fortunately Rx simplifies many operations that it nearly feels unnecessary to mention them. All we have to do to achieve the desired behavior is to call the <code>distinctUntilChanged</code> operator right after we called <code>debounceTime(400)</code>. Again, we will get back an <code>Observable&lt;string&gt;</code> but one that ignores values that are the same as the previous.</p>

<p><strong>Dealing with out-of-order responses</strong></p>

<p>Dealing with out of order responses can be a tricky task. Basically we need a way to express that we aren’t interested anymore in results from previous in-flight requests as soon as we are sending out new requests. In other words: cancel out all previous request as soon as we start a new one. As I briefly mentioned in the beginning Observables are disposable which means we can unsubscribe from them.</p>

<p>This is where we want to change our <code>WikipediaService</code> to return an <code>Observable&lt;Array&lt;string&gt;&gt;</code> instead of an <code>Promise&lt;Array&lt;string&gt;&gt;</code>. That’s as easy as dropping <code>toPromise</code> and using <code>map</code> instead of <code>then</code>.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">search</span> <span class="p">(</span><span class="nx">term</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">()</span>
  <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'action'</span><span class="p">,</span> <span class="s1">'opensearch'</span><span class="p">);</span>
  <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'search'</span><span class="p">,</span> <span class="nx">term</span><span class="p">);</span>
  <span class="nx">search</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'format'</span><span class="p">,</span> <span class="s1">'json'</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">jsonp</span>
              <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'http://en.wikipedia.org/w/api.php?callback=JSONP_CALLBACK'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">search</span> <span class="p">})</span>
              <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span></code></pre></div>

<p>Now that our <code>WikipediaSerice</code> returns an Observable instead of a Promise we simply need to replace <code>then</code> with <code>subscribe</code> in our <code>App</code> component.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">valueChanges</span>
           <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">distinctUntilChanged</span><span class="p">()</span>
           <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">term</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">wikipediaService</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">items</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">));</span></code></pre></div>

<p>But now we have two <code>subscribe</code> calls. This is needlessly verbose and often a sign for unidiomatic usage.
The good news is, now that <code>search</code> returns an <code>Observable&lt;Array&lt;string&gt;&gt;</code> we can simply use <code>flatMap</code> to project our <code>Observable&lt;string&gt;</code> into the desired <code>Observable&lt;Array&lt;string&gt;&gt;</code> by composing the Observables.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">valueChanges</span>
         <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
         <span class="p">.</span><span class="nx">distinctUntilChanged</span><span class="p">()</span>
         <span class="p">.</span><span class="nx">flatMap</span><span class="p">(</span><span class="nx">term</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">wikipediaService</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">))</span>
         <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">items</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">);</span></code></pre></div>

<p>You may be wondering what <code>flatMap</code> does and why we can’t use <code>map</code> here. The answer is quite simple. The <code>map</code> operator expects a function that takes a value <code>T</code> and returns a value <code>U</code>. For instance a function that takes in a <code>string</code> and returns a <code>Number</code>. Hence when you use <code>map</code> you get from an <code>Observable&lt;T&gt;</code> to an <code>Observable&lt;U&gt;</code>. However, our <code>search</code> method produces an <code>Observable&lt;Array&gt;</code> itself. So coming from an <code>Observable&lt;string&gt;</code> that we have right after <code>distinctUntilChanged</code>, map would take us to an <code>Observable&lt;Observable&lt;Array&lt;string&gt;&gt;</code>. That’s not quite what we want.</p>

<p>The <code>flatMap</code> operator on the other hand expects a function that takes a <code>T</code> and returns an <code>Observable&lt;U&gt;</code> and produces an <code>Observable&lt;U&gt;</code> for us.</p>

<p><strong>NOTE</strong>: <em>That’s not entirely true, but it helps as a simplification</em>.</p>

<p>That perfectly matches our case. We have an <code>Observable&lt;string&gt;</code>, then call <code>flatMap</code> with a function that takes a <code>string</code> and returns an <code>Observable&lt;Array&lt;string&gt;&gt;</code>.</p>

<p>So does this solve our out-of-order response issues? Unfortunately not. So, why am I bothering you with all this in the first place? Well, now that you understood <code>flatMap</code> just replace it with <code>switchMap</code> and you are done.</p>

<p>What?! You may be wondering if I’m kidding you but no I am not. That’s the beautify of Rx with all it’s useful operators. The <code>switchMap</code> operator is comparable to <code>flatMap</code> in a way. Both operators automatically subscribe to the Observable that the function produces and flatten the result for us. The difference is that the <code>switchMap</code> operator automatically unsubscribes from previous subscriptions as soon as the outer Observable emits new values.</p>

<h2 id="putting-some-sugar-on-top">Putting some sugar on top</h2>

<p>Now that we got the semantics right, there’s one more little trick that we can use to save us some typing. Instead of manually subscribing to the Observable we can let Angular do the unwrapping for us right from within the template. All we have to do to accomplish that is to use the <code>AsyncPipe</code> in our template and expose the <code>Observable&lt;Array&lt;string&gt;&gt;</code> instead of <code>Array&lt;string&gt;</code>.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'my-app'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;div&gt;
      &lt;h2&gt;Wikipedia Search&lt;/h2&gt;
      &lt;input type="text" [formControl]="term"/&gt;
      &lt;ul&gt;
        &lt;li *ngFor="let item of items | async"&gt;{{item}}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  `</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">App</span> <span class="p">{</span>

  <span class="nl">items</span><span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
  <span class="nx">term</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormControl</span><span class="p">();</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">wikipediaService</span><span class="p">:</span> <span class="nx">WikipediaService</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">valueChanges</span>
                 <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
                 <span class="p">.</span><span class="nx">distinctUntilChanged</span><span class="p">()</span>
                 <span class="p">.</span><span class="nx">switchMap</span><span class="p">(</span><span class="nx">term</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">wikipediaService</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">term</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>And voilà, we’re done. Check out the demos below!</p>


          
  <h2 id="videos">Videos on this article</h2>
  
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311616" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311614" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311611" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311613" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311609" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181311615" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
  



  <h2 id="demos">Demos</h2>
  
  <ul>
    
    <li><a href="http://plnkr.co/edit/8ap1Lm?p=preview" title="Basic Wikipedia search using Angular 2" target="_blank">Basic Wikipedia search using Angular 2</a></li>
    
    <li><a href="http://embed.plnkr.co/SIltBL/" title="Smart Wikipedia search using Angular 2" target="_blank">Smart Wikipedia search using Angular 2</a></li>
    
  </ul>
  



        </div>

        <div class="thtrm-subscriber">
  <h3>Get updates on new articles and trainings.</h3>
  <p>Join over 1400 other developers who get our content first.</p>
  <form action="//thoughtram.us8.list-manage.com/subscribe/post?u=dfbb1507fbced5a20d9dc5698&amp;id=731f22cdca" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <label for="mce-EMAIL"></label>
    <input type="email" value="" name="EMAIL" placeholder="Your email address..." required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_dfbb1507fbced5a20d9dc5698_731f22cdca" tabindex="-1" value=""></div>
    <input type="submit" value="Subscribe" name="subscribe" class="thtrm-cta thtrm-cta--small">
  </form>
</div>



        <div class="thtrm-social-links">
            <!-- Sharingbutton Facebook -->
            <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.thoughtram.io/angular/2016/01/06/taking-advantage-of-observables-in-angular2.html" target="_blank" aria-label="Share on Facebook">
              <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"/>
                    </g>
                </svg>
                </div>Share on Facebook</div>
            </a>

            <!-- Sharingbutton Twitter -->
            <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Taking%20advantage%20of%20Observables%20in%20Angular&amp;url=http://blog.thoughtram.io/angular/2016/01/06/taking-advantage-of-observables-in-angular2.html" target="_blank" aria-label="Share on Twitter">
              <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"/>
                    </g>
                </svg>
                </div>Share on Twitter</div>
            </a>

            <!-- Sharingbutton Google+ -->
            <a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http%3A%2F%2Fblog.thoughtram.io/angular/2016/01/06/taking-advantage-of-observables-in-angular2.html" target="_blank" aria-label="Share on Google+">
              <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"/>
                        <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5   "/>
                    </g>
                </svg>
                </div>Share on Google+</div>
            </a>
        </div>

        <h3 class="thtrm-section-headline thtrm-section-headline--with-margin">Author</h3>
        <div class="thtrm-article-author">
          <span class="thtrm-article-author-avatar"><img src="/images/author-christoph.jpg" alt="Picture of Christoph Burgdorf"></span>
          <div class="thtrm-article-author-matter">
            <h4 class="thtrm-article-author-name">Christoph Burgdorf</h4>
            <p class="thtrm-article-author-text">Christoph began programming at the age of 10. He is the creator of the Nickel.rs web framework and a contributor of the AngularJS project. Christoph is also part of the Angular 2 Docs Authoring team.</p>
            <p>
              <a class="thtrm-article-author-cta thtrm-article-author-cta-twitter" href="http://twitter.com/cburgdorf" title="Christoph Burgdorf on Twitter">Twitter</a>
              <a class="thtrm-article-author-cta" href="http://github.com/cburgdorf" title="Christoph Burgdorf on GitHub">GitHub</a>
            </p>
          </div>
        </div>
      </div>

      <div class="thtrm-constraint">

        
        <h4 class="thtrm-section-headline thtrm-section-headline--with-big-margin thtrm-section-headline--centered">Related Posts</h4>
        <ul class="thtrm-three-column-list thtrm-three-column-list--with-padding">
        
        
          
          <li>
            <a class="thtrm-article-card" href="/rx/2016/08/01/exploring-rx-operators-flatmap.html" title="Exploring Rx Operators: flatMap">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/rx-flatmap.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Exploring Rx Operators: flatMap</h3>
                <p>Another post in a series of articles to discover the magic of different Rx operators. In this article we like...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/01/07/taking-advantage-of-observables-in-angular2-pt2.html" title="Taking advantage of Observables in Angular 2 - Part 2">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/fallback.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Taking advantage of Observables in Angular 2 - Part 2</h3>
                <p>This is a follow up article that demonstrates how Observables can influence our API design.</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/06/16/cold-vs-hot-observables.html" title="Cold vs Hot Observables">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/hot-vs-cold-observables.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Cold vs Hot Observables</h3>
                <p>In this article we are going to demystify what the term hot vs cold means when it comes to Observables....</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/05/16/exploring-rx-operators-map.html" title="Exploring Rx Operators: map">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/rx-map.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Exploring Rx Operators: map</h3>
                <p>This is the first article that is part of a new series where we take a look at different operators...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/02/27/three-things-you-didnt-know-about-the-async-pipe.html" title="Three things you didn't know about the AsyncPipe">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/three-things-about-the-async-pipe.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Three things you didn't know about the AsyncPipe</h3>
                <p>This article explains three lesser known features of the AsyncPipe that help us to write better async code.</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/02/21/using-zones-in-angular-for-better-performance.html" title="Using Zones in Angular for better performance">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/using-zones-in-angular-for-better-performance.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Using Zones in Angular for better performance</h3>
                <p>In this article we'll take a look at how to use Zone APIs to improve our app's performance!</p>
              </div>
            </a>
          </li>
        
        
        </ul>
        

      

      </div>
    </main>
    <footer role="contentinfo" class="thtrm-footer thtrm-footer--slim">
  <div class="thtrm-footer-text">
    <img class="thtrm-footer-logo" alt="thoughtram brain" src="/images/thoughtram-brain-white.png">
    <p>This website was created in collaboration with <a href="http://twitter.com/timche_" title="Tim Cheung on Twitter"><strong>Tim Cheung</strong></a> and <a href="http://twitter.com/tim_hartmann_" title="Tim Hartmann on Twitter"><strong>Tim Hartmann</strong></a>.</p>
    <p ><a href="http://thoughtram.io/code-of-conduct.html" title="Code of Conduct">Code of Conduct</a> &bullet; <a href="http://thoughtram.io/imprint.html" title="Legal Notice">Legal notice</a></p>
    <p class="thtrm-footer-bottom">&copy; 2014-2017 thoughtram GmbH</p>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51360648-2', 'auto');
ga('send', 'pageview');

var form = document.getElementById('search-form');
var eventCta = document.getElementById('event-cta');

if (eventCta) {

  eventCta.addEventListener('click', function (event) {
    event.preventDefault();

    setTimeout(clickLink, 1000);

    function clickLink() {
      window.location.replace(eventCta.getAttribute('href'));
    }

    ga('send', 'event', {
      eventCategory: 'Event Link',
      eventAction: 'click',
      eventLabel: eventCta.getAttribute('title'),
      hitCallback: clickLink
    });
  });
}

if (form) {

  var searchTerm = document.getElementById('search-term');

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    var formSubmitted = false;

    setTimeout(submitForm, 1000);

    function submitForm() {
      if (!formSubmitted) {
        formSubmitted = true;
        form.submit();
      }
    }

    ga('send', 'event', {
      eventCategory: 'Search Form',
      eventAction: 'submit',
      eventLabel: searchTerm.value,
      hitCallback: submitForm
    });
  });
}
</script>



    <script src="/scripts/stickyfill.js"></script>
    <script src="/scripts/linkjuice/dist/linkjuice.js"></script>
    <script>
    (function (doc, win) {

      linkjuice.init('.thtrm-article', {
        selector: ['h2', 'h3'],
        icon: ''
      });

      if (win.matchMedia && win.matchMedia('(min-width: 1200px)').matches) {
        var stickyElements = doc.querySelectorAll('.is-sticky');

        for (var i = stickyElements.length - 1; i >= 0; i--) {
          var el = stickyElements[i];

          if (el.classList.contains('thtrm-toc')) {
            el.classList.add('thtrm-toc--sticky');
            el.classList.add('thtrm-toc--faded');
          } 
          if (el.classList.contains('thtrm-ad')) {
            el.classList.add('thtrm-ad--sticky');
            el.classList.add('thtrm-ad--description');
          }

          Stickyfill.add(el);
        }
      }
    }(document, window));
    </script>
  </body>
</html>
